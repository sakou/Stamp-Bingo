# 4店舗合同 プレミアム・スタンプラリー 要件定義書

## 1. プロジェクト概要

| 項目 | 詳細 |
| :--- | :--- |
| **プロジェクト名** | 4店舗合同 プレミアム・スタンプラリー |
| **目的** | 4店舗のコラボメニューを通じた活性化と、集客力に差があるC・D店舗への顧客回遊の促進（集客の平準化）。C・D店舗のプライドを尊重し、長期的なSNS集客力向上を目指す。 |
| **対象店舗** | A、B、C、Dの飲食店4店舗 |
| **期間** | 1ヶ月間 |
| **方式** | Webブラウザベースのデジタルスタンプラリー（QRコード方式） |
| **想定参加者数** | 延べ100名以下 |

---

## 2. ビジネス要件（機能・仕様）

| No. | 機能・仕様 | 詳細 | 目的／備考 |
| :--- | :--- | :--- | :--- |
| **B-1** | **スタンプ名称と配点** | **A, B店舗（コラボ・スタンプ）：1ポイント** / **C, D店舗（プレミアム・スタンプ）：最大2ポイント** | C・D店舗への訪問インセンティブ強化。 |
| **B-2** | **C・D店舗の特別条件** | 2ポイント獲得には、以下をスタッフが目視で確認する。 **① コラボメニュー注文** / **② 店舗Instagramのフォロー** / **③ SNS投稿またはアンケート回答** | C・Dのプライド尊重（優遇ではなく特別ミッションへの報酬）と、SNSでの認知拡大。 |
| **B-3** | **ビンゴの条件** | $3 \times 3$ マスを使用。縦・横・斜めのいずれか1列が揃えばビンゴ達成。景品獲得には**C・D店舗のスタンプが必須となるマス配置**とする。 | A・Bの既存客をC・Dへ誘導する動線確保。 |
| **B-4** | **景品の種類と内容**| 景品は以下の3段階とし、参加店舗の協議で決定する。 | 客単価（¥3,000〜¥5,000）を考慮したインセンティブ。 |
| | **レベル1 (シングルビンゴ):** | 次回使える**コラボメニュー10%割引クーポン**（4店舗共通） | 1列達成で獲得 |
| | **レベル2 (ダブルビンゴ):** | 4店舗共通の**¥1,000分食事券** | 2列達成で獲得 |
| | **レベル3 (フルコンプリート):** | 4店舗共通の**¥5,000分食事券** | 全9マス達成で獲得 |
| **B-5** | **景品の引換方法** | 物理クーポン（紙券等）として各店舗で手渡し。有効期限は各店舗が印刷時に記載。システムでは「引換済み」フラグで二重発行を防止。 | 運用効率化と不正利用防止。 |
| **B-6** | **注意書き** | ユーザー向けサイトにて、「ブラウザの変更やCookieの削除でデータが消える可能性がある」旨を明確に記載する。 | ユーザー認証（Cookie）の脆弱性に対する事前の告知。 |
| **B-7** | **ポイント累積方式** | 各マスには必要ポイント数が設定されており、同じマスに対して複数回訪問でポイントを累積できる。例：2pt必要なマスに1pt訪問を2回行うことで達成可能。 | ユーザー体験の向上と再訪問促進。 |

---

## 3. システム要件（機能および非機能）

### 3-1. ユーザー向け機能

| No. | 機能名 | 要件詳細 |
| :--- | :--- | :--- |
| **S-U1** | **スタンプラリー画面** | ユーザーのビンゴカード進捗状況（マス目のポイント反映）をリアルタイムで表示する。各マスには「0/1pt」「1/2pt」等の進捗を表示。 |
| **S-U2** | **スタンプ獲得** | 店舗スタッフが提示した**店舗別QRコード**を読み込むことで、スタンプ獲得画面に遷移し、URLパラメータに基づき店舗IDとポイント数を判定して付与する。 |
| **S-U3** | **ビンゴ判定・景品発行** | ビンゴ達成時に自動判定を行い、景品獲得画面を表示する。店舗スタッフが物理クーポンを手渡し後、「引換済み」処理を行う。 |
| **S-U4** | **ユーザー認証** | **Cookie**または端末識別情報（UUID）を用いて進捗を保存する。 |
| **S-U5** | **実績データの保存** | **Instagram ID**の任意入力欄を初回スタンプ獲得時に表示。入力された場合はスキャン実績と紐づけてサーバーにも永続的に保存する。（Cookie破損時のリカバリー支援のため） |

### 3-2. 店舗スタッフ・管理者向け機能

| No. | 機能名 | 要件詳細 |
| :--- | :--- | :--- |
| **S-T1** | **店舗別管理画面** | 各店舗は専用IDでログインし、**自店舗で付与したスキャン実績**（日時、ユーザーID、インスタIDなど）を確認できる。 |
| **S-T2** | **不正スキャン削除機能** | 店舗スタッフは、管理画面から**自店舗で付与した最新のスキャン実績**について、不正が疑われる場合に**削除（ポイントの取り消し）**ができる。 |
| **S-T3** | **クーポン利用処理** | 景品引換時に、スタッフが管理画面でユーザーIDを確認し、**クーポンを引換済みとして処理**できる。 |
| **S-T4** | **全体実績確認 (管理者)** | 管理者（主催者1名）は全店舗のスキャン実績、ビンゴ達成数、景品利用状況、**C・D店舗への回遊実績**などのデータを一元的に確認・ダウンロードできる。 |
| **S-T5** | **QRコード運用** | 店舗別に異なるURLパラメータ付きQRコードを計6種類用意する。A店×1、B店×1、C・D店×各2種類（通常1pt/プレミアム2pt）。店舗スタッフがC・D店の特別条件確認後、適切なQRコードを提示する。 |

### 3-3. 非機能要件（運用・技術・障害対応）

| 項目 | 要件詳細 | 備考 |
| :--- | :--- | :--- |
| **可用性 (障害対応)** | **【最重要：フォールバック戦略】** システム障害に備え、全店舗で**紙媒体の代替スタンプ台紙**を用意する。障害発生時は紙台紙への移行運用を行い、顧客体験の継続性を確保する。 | 紙台紙の様式や移行手順は、運用マニュアルで詳細に定義する。 |
| **データ保全** | すべてのスタンプ付与履歴をデータベースとは別に**ファイルログとして保存**する。 | 障害復旧時のデータ整合性確認と復旧に利用する。 |
| **稼働時間** | 24時間365日稼働を前提とする。 | |
| **レスポンス** | スタンプ獲得時の処理は**3秒以内**に完了すること。 | 顧客の離脱を防ぐため。 |
| **セキュリティ** | SSL/TLSによる通信の暗号化。インスタIDなどの個人情報の取り扱いに関する適切なセキュリティ対策を実施する。 | |
| **データ保持** | キャンペーン終了後、分析のため**1年間**はスキャン実績データを保持する。 | |
| **メンテナンス** | 期間中のシステム障害発生時の連絡体制と復旧時間の目安を定め、全店舗に共有する。 | |

---

## 4. ビンゴカード配置設計

### 4-1. マス配置

全8ライン（横3、縦3、斜め2）のいずれでビンゴしても、必ずC・D店舗のマスを通る設計とする。

```
[A店 1pt] [C店 2pt] [B店 1pt]
[C店 2pt] [D店 2pt] [A店 1pt]
[B店 1pt] [A店 1pt] [D店 2pt]
```

### 4-2. 店舗バランス

- **A店**: 3マス（最低3回訪問が必要）
- **B店**: 3マス（最低3回訪問が必要）
- **C店**: 2マス（最低2回訪問、最大4回訪問で達成可能）
- **D店**: 2マス（最低2回訪問、最大4回訪問で達成可能）

### 4-3. 全ライン検証結果

| ライン | マス構成 | C・D店含有 |
|:---|:---|:---:|
| 横1段目 | A + C + B | ✓ (C店) |
| 横2段目 | C + D + A | ✓ (C・D店) |
| 横3段目 | B + A + D | ✓ (D店) |
| 縦1列目 | A + C + B | ✓ (C店) |
| 縦2列目 | C + D + A | ✓ (C・D店) |
| 縦3列目 | B + A + D | ✓ (D店) |
| 斜め↘ | A + D + D | ✓ (D店) |
| 斜め↙ | B + D + B | ✓ (D店) |

**結論**: 全8ラインでC・D店舗への訪問が必須となる設計が完了。

---

## 5. QRコード一覧

| 店舗 | 種類 | URLパラメータ | 付与ポイント | 備考 |
|:---|:---|:---|:---:|:---|
| A店 | 通常 | `?store=A&points=1` | 1pt | - |
| B店 | 通常 | `?store=B&points=1` | 1pt | - |
| C店 | 通常 | `?store=C&points=1` | 1pt | 条件未達成時 |
| C店 | プレミアム | `?store=C&points=2` | 2pt | 特別条件達成時 |
| D店 | 通常 | `?store=D&points=1` | 1pt | 条件未達成時 |
| D店 | プレミアム | `?store=D&points=2` | 2pt | 特別条件達成時 |

**合計**: 6種類のQRコード

---

## 6. Instagram ID 入力仕様

### 入力タイミング
初回スタンプ獲得時に入力画面を表示

### 入力形式
- 入力欄には先頭に `@` を固定表示
- ユーザーが `@` を入力しても自動で削除
- 例: `@tanaka_taro` → システムには `tanaka_taro` として保存

### 必須/任意
完全に任意。未入力でもスタンプラリー参加は可能。

### システム識別子
Instagram ID未入力でも、システム側でUUID（ユニークID）を自動生成してユーザーを識別。

---

## 7. 変更履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|:---|:---|:---|:---|
| 2025-10-25 | 1.0 | 初版作成 | - |
