# 4店舗合同 ビンゴスタンプラリー 要件定義書 v2.0

## 1. プロジェクト概要

| 項目 | 詳細 |
| :--- | :--- |
| **プロジェクト名** | 4店舗合同 ビンゴスタンプラリー |
| **目的** | 4店舗のコラボ企画を通じた集客促進と顧客回遊の活性化。複数回訪問を促すビンゴゲーム形式のスタンプラリー。 |
| **対象店舗** | A、B、C、Dの飲食店4店舗（店舗数は固定） |
| **実施形態** | イベント単位で実施。同時に複数イベントは実施できず、新イベント開始には現イベントの中断が必要。 |
| **方式** | Webブラウザベースのデジタルビンゴスタンプラリー（QRコード方式） |
| **想定参加者数** | イベントごとに延べ100名程度 |

---

## 2. イベント管理要件

### 2-1. イベント基本情報

| 項目 | 詳細 | 備考 |
|:---|:---|:---|
| **イベントID** | システムが自動生成するユニークID | 例: evt_2025_spring_001 |
| **イベント名** | 管理者が入力 | 例: 「春の4店舗合同ビンゴラリー」 |
| **開催期間** | 開始日時・終了日時 | 管理者が設定 |
| **イベント説明** | イベントの概要説明文 | 利用者画面に表示 |
| **ステータス** | 準備中 / 開催中 / 終了 | システムで管理 |

### 2-2. イベント運用ルール

- **同時実施制限**: アクティブなイベントは1つのみ
- **切り替え**: 新しいイベントを開始するには、現在のイベントを「終了」ステータスにする必要がある
- **過去イベント**: 終了したイベントのデータは保持され、参照可能
- **再利用**: 新しいイベント作成時に過去イベントの設定をテンプレートとして利用可能

---

## 3. ビジネス要件（機能・仕様）

### 3-1. ビンゴカードの仕様

| 項目 | 詳細 |
|:---|:---|
| **カードサイズ** | 5×5 = 25マス |
| **FREEマス** | 中央マス（3行3列目）は最初から達成済み |
| **店舗配分** | A店6マス、B店6マス、C店6マス、D店6マス、FREE1マス |
| **マス表示** | 「店舗名 + 訪問回数」（例: A店 1回目、B店 2回目） |
| **ビンゴライン** | 横5本、縦5本、斜め2本 = 合計12本 |

### 3-2. 訪問回数システム

| 項目 | 詳細 |
|:---|:---|
| **QRコード** | 各店舗1つずつ（合計4種類） |
| **スタンプ獲得方法** | 店舗でQRコードをスキャン |
| **訪問カウント** | 1回訪問ごとに次のマスが開く（例: A店1回目→A店2回目→A店3回目...） |
| **最大訪問回数** | 各店舗6回まで |
| **順序** | 必ず1回目から順番に開く（飛ばしは不可） |

### 3-3. 景品設定

管理者がイベントごとに以下の情報を設定可能：

| ビンゴライン数 | 設定項目 |
|:---|:---|
| **1ライン達成** | 景品名、説明、有効期限 |
| **2ライン達成** | 景品名、説明、有効期限 |
| **3ライン達成** | 景品名、説明、有効期限 |

**デフォルト例**:
- 1ライン: 10%割引クーポン
- 2ライン: ¥1,000食事券
- 3ライン: ¥5,000食事券

### 3-4. 景品の引換方法

| 項目 | 詳細 |
|:---|:---|
| **引換方式** | 物理クーポン（紙券等）を各店舗で手渡し |
| **有効期限** | 管理者が設定した期限を各店舗が印刷時に記載 |
| **二重発行防止** | システムで「引換済み」フラグを管理 |

---

## 4. ビンゴカード配置設計

### 4-1. 5×5マス配置

全てのビンゴラインで複数店舗が混在する設計（同じ店舗が5マス並ぶことはない）:

```
[A店1回目] [C店1回目] [B店1回目] [D店1回目] [B店2回目]
[B店3回目] [D店2回目] [C店2回目] [A店2回目] [A店3回目]
[C店3回目] [A店4回目] [  FREE  ] [B店4回目] [D店3回目]
[D店4回目] [B店5回目] [A店5回目] [C店4回目] [D店5回目]
[A店6回目] [C店5回目] [D店6回目] [C店6回目] [B店6回目]
```

### 4-2. 配置の検証結果

**横ライン（5本）**:
1. A-C-B-D-B ✓ (複数店舗混在)
2. B-D-C-A-A ✓ (複数店舗混在)
3. C-A-FREE-B-D ✓ (複数店舗混在)
4. D-B-A-C-D ✓ (複数店舗混在)
5. A-C-D-C-B ✓ (複数店舗混在)

**縦ライン（5本）**:
1. A-B-C-D-A ✓ (複数店舗混在)
2. C-D-A-B-C ✓ (複数店舗混在)
3. B-C-FREE-A-D ✓ (複数店舗混在)
4. D-A-B-C-C ✓ (複数店舗混在)
5. B-A-D-D-B ✓ (複数店舗混在)

**斜めライン（2本）**:
1. A-D-FREE-C-B ✓ (複数店舗混在)
2. B-A-FREE-B-A ✓ (複数店舗混在)

**結論**: 全12ラインで複数店舗が混在し、特定店舗だけでビンゴできない設計を実現。

---

## 5. QRコード仕様

| 店舗 | QRコード数 | URLパラメータ例 | 動作 |
|:---|:---:|:---|:---|
| A店 | 1個 | `?event={event_id}&store=A` | A店の次の未達成マスを開く（1→2→3→4→5→6） |
| B店 | 1個 | `?event={event_id}&store=B` | B店の次の未達成マスを開く |
| C店 | 1個 | `?event={event_id}&store=C` | C店の次の未達成マスを開く |
| D店 | 1個 | `?event={event_id}&store=D` | D店の次の未達成マスを開く |

**合計**: 4種類のQRコード（イベントごとに生成）

---

## 6. システム要件

### 6-1. ユーザー向け機能

| No. | 機能名 | 要件詳細 |
|:---|:---|:---|
| **U-1** | **ビンゴカード表示** | 5×5ビンゴカードと達成状況をリアルタイム表示 |
| **U-2** | **スタンプ獲得** | 店舗QRコードをスキャンして次の未達成マスを開く |
| **U-3** | **ビンゴ判定** | ライン達成時に自動判定し、景品情報を表示 |
| **U-4** | **イベント情報表示** | イベント名、期間、参加条件、景品情報を表示 |
| **U-5** | **店舗情報表示** | 各店舗の名称、説明、SNSリンクを表示 |
| **U-6** | **進捗保存** | Cookie/localStorageで進捗を保存 |

### 6-2. 管理者向け機能

| No. | 機能名 | 要件詳細 |
|:---|:---|:---|
| **A-1** | **イベント作成** | 基本情報（名称、期間、説明）の入力 |
| **A-2** | **店舗情報設定** | 4店舗の名称、SNS URL、説明の設定 |
| **A-3** | **参加条件設定** | 参加条件テキストの入力（改行対応） |
| **A-4** | **景品設定** | 3段階の景品情報（名称、説明、有効期限）の入力 |
| **A-5** | **QRコード生成** | イベントIDを含む4種類のQRコード生成 |
| **A-6** | **イベント公開管理** | ステータス変更（準備中→開催中→終了） |
| **A-7** | **プレビュー** | 利用者画面のプレビュー表示 |
| **A-8** | **統計閲覧** | 参加者数、ビンゴ達成数、景品引換数の確認 |

### 6-3. 非機能要件

| 項目 | 要件詳細 |
|:---|:---|
| **可用性** | 24時間365日稼働 |
| **レスポンス** | スタンプ獲得処理は3秒以内 |
| **セキュリティ** | SSL/TLS通信、個人情報の適切な取り扱い |
| **データ保持** | イベント終了後1年間データ保持 |
| **ブラウザ対応** | Chrome, Safari, Edge最新版 |
| **モバイル対応** | iPhone, Android対応（レスポンシブデザイン） |

---

## 7. 画面構成

### 7-1. 利用者画面

```
┌─────────────────────────┐
│ イベント名              │
│ 期間: 2025/04/01-04/30  │
├─────────────────────────┤
│   5×5 ビンゴカード      │
│   （達成状況表示）      │
├─────────────────────────┤
│ 参加店舗紹介            │
│ (A店/B店/C店/D店)       │
├─────────────────────────┤
│ 遊び方                  │
├─────────────────────────┤
│ 参加条件                │
├─────────────────────────┤
│ 景品                    │
│ - 1ライン: xxx          │
│ - 2ライン: xxx          │
│ - 3ライン: xxx          │
└─────────────────────────┘
```

### 7-2. 管理者画面（設定モーダル）

```
┌─────────────────────────────┐
│ ⚙️ イベント設定             │
├─────────────────────────────┤
│ [基本情報][店舗][条件][景品]│
├─────────────────────────────┤
│ 【選択中タブの内容】        │
│                             │
│ [保存] [キャンセル]         │
└─────────────────────────────┘
```

---

## 8. データ構造（localStorage設計）

プロトタイプではlocalStorageで以下の構造を使用：

```javascript
{
  // イベント基本情報
  eventInfo: {
    eventId: "evt_2025_spring_001",
    eventName: "春の4店舗合同ビンゴラリー",
    startDate: "2025-04-01",
    endDate: "2025-04-30",
    description: "4店舗を巡って豪華景品をゲット！"
  },

  // 店舗情報
  storeInfo: {
    a: { name: "A店", instagram: "...", twitter: "...", tiktok: "...", description: "..." },
    b: { name: "B店", ... },
    c: { name: "C店", ... },
    d: { name: "D店", ... }
  },

  // 参加条件
  generalSettings: {
    conditions: "① コラボメニューを注文\n② 店舗のInstagramをフォロー\n..."
  },

  // 景品設定
  prizes: {
    line1: { name: "10%割引クーポン", description: "...", validUntil: "2025-05-31" },
    line2: { name: "¥1,000食事券", description: "...", validUntil: "2025-05-31" },
    line3: { name: "¥5,000食事券", description: "...", validUntil: "2025-06-30" }
  },

  // ユーザー進捗（利用者側）
  userProgress: {
    a: 0,  // A店の訪問回数（0-6）
    b: 0,
    c: 0,
    d: 0
  }
}
```

---

## 9. Instagram ID 入力仕様（将来実装）

### 入力タイミング
初回スタンプ獲得時に入力画面を表示

### 入力形式
- 入力欄には先頭に `@` を固定表示
- ユーザーが `@` を入力しても自動で削除
- 例: `@tanaka_taro` → システムには `tanaka_taro` として保存

### 必須/任意
完全に任意。未入力でもスタンプラリー参加は可能。

### システム識別子
Instagram ID未入力でも、システム側でUUID（ユニークID）を自動生成してユーザーを識別。

---

## 10. 変更履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|:---|:---|:---|:---|
| 2025-10-25 | 1.0 | 初版作成（3×3ビンゴ、ポイント制） | - |
| 2025-10-25 | 2.0 | 5×5ビンゴに変更、ポイント削除、訪問回数ベースに変更、イベント管理機能追加、景品設定を管理者入力可能に変更 | - |

---

## 11. 備考

### システム設計時の考慮事項
- 将来的にNext.js + TypeScript + PostgreSQLで本格実装予定
- プロトタイプはHTML/CSS/JavaScriptの単一ファイル
- イベント切り替え時のデータ移行戦略を設計時に検討
- 統計機能（参加者数、達成率など）の詳細仕様は本格実装時に定義
